git:
    depth: 1

cache:
    directories:
        - $HOME/.composer

sudo: false

language: php

notifications:
    email: false

before_install:
    - composer self-update
    - composer global show hirak/prestissimo -q || composer global require hirak/prestissimo

install: composer install

script: composer check

jobs:
    include:
        - &STANDARD_TEST_JOB
            stage: Test
            php: '7.1'
            install: composer update --prefer-lowest
        -
            <<: *STANDARD_TEST_JOB
            stage: Test
            php: '7.1'
        -
            <<: *STANDARD_TEST_JOB
            stage: Test
            php: '7.2'
        -
            <<: *STANDARD_TEST_JOB
            stage: Test
            php: '7.2'
            install: composer require --dev php-coveralls/php-coveralls
            script: composer phpunit -- --coverage-clover=build/logs/clover.xml
            after_success: vendor/bin/php-coveralls
