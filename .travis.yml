git:
    depth: 1

cache:
    directories:
        - $HOME/.composer/cache

sudo: false

language: php

notifications:
    email: false

before_install:
    - composer self-update --stable

jobs:
    include:
        - &STANDARD_TEST_JOB
            stage: Test
            php: '7.1'
            install: composer update --prefer-lowest
        -
            <<: *STANDARD_TEST_JOB
            stage: Test
            php: '7.1'
        -
            <<: *STANDARD_TEST_JOB
            stage: Test
            php: '7.2'
            script:
                - vendor/bin/phpunit --configuration=tests --coverage-clover=coverage.xml
            after_success:
                - bash <(curl -s https://codecov.io/bash)

        -
            stage: Stage 2
            php: '7.2'
            script:
                - vendor/bin/phpunit --configuration=tests

install:
    - composer install

script:
    - vendor/bin/phpcs --report-full --standard=PSR2 src tests
    - vendor/bin/php-cs-fixer fix --config=tests/php-cs-fixer.config.php --diff --dry-run
    - vendor/bin/types-checker src tests
    - vendor/bin/psalm --config=tests/psalm.xml
    - phpdbg -qrr vendor/bin/phpunit --configuration=tests
